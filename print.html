<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Getting Started with CheriBSD</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="cover/index.html">Getting Started with CheriBSD</a></li><li class="chapter-item expanded "><a href="introduction/index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="background/index.html"><strong aria-hidden="true">2.</strong> Background</a></li><li class="chapter-item expanded "><a href="features/index.html"><strong aria-hidden="true">3.</strong> CheriBSD features</a></li><li class="chapter-item expanded "><a href="nonfeatures/index.html"><strong aria-hidden="true">4.</strong> Unsupported FreeBSD features</a></li><li class="chapter-item expanded "><a href="getting/index.html"><strong aria-hidden="true">5.</strong> Getting CheriBSD</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="downloading/index.html"><strong aria-hidden="true">5.1.</strong> Downloading image files</a></li><li class="chapter-item expanded "><a href="building/index.html"><strong aria-hidden="true">5.2.</strong> Building image files</a></li></ol></li><li class="chapter-item expanded "><a href="installing/index.html"><strong aria-hidden="true">6.</strong> Installing on an Arm Morello Board</a></li><li class="chapter-item expanded "><a href="packages/index.html"><strong aria-hidden="true">7.</strong> Third-party packages</a></li><li class="chapter-item expanded "><a href="helloworld/index.html"><strong aria-hidden="true">8.</strong> CheriABI &quot;Hello World&quot;</a></li><li class="chapter-item expanded "><a href="issues/index.html"><strong aria-hidden="true">9.</strong> Morello known issues</a></li><li class="chapter-item expanded "><a href="support/index.html"><strong aria-hidden="true">10.</strong> Getting help</a></li><li class="chapter-item expanded "><a href="resources/index.html"><strong aria-hidden="true">11.</strong> Resources</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Getting Started with CheriBSD</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <a href="https://github.com/CTSRD-CHERI/cheribsd-getting-started" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#getting-started-with-cheribsd" id="getting-started-with-cheribsd">Getting Started with CheriBSD</a></h1>
<p>Robert N. M. Watson (University of Cambridge)
and
Brooks Davis (SRI International)</p>
<p>This is a living document that describes how to get up and running with
<a href="https://www.cheribsd.org/">CheriBSD</a> on Morello and CHERI-RISC-V.
Topics include how to download and install prebuilt CheriBSD images, how to
build your own images, how third-party packages work, and where to find
further information and support.</p>
<p><em>This document is a work-in-progress.  Feedback and contributions are
welcomed.  Please see our <a href="https://github.com/CTSRD-CHERI/cheribsd-getting-started">GitHub
Repository</a> for the
source code and an issue tracker.
There is a <a href="https://ctsrd-cheri.github.io/cheribsd-getting-started/">rendered version on the
web</a>, which is
automatically updated when the git repository is committed to.</em></p>
<h2><a class="header" href="#acknowledgements" id="acknowledgements">Acknowledgements</a></h2>
<p>The authors gratefully acknowledge Jessica Clarke (University of Cambridge),
George Neville-Neil (MSB Associates), and Konrad Witaszczy (University of
Cambridge)</p>
<p>This work was supported by the Innovate UK project Digital Security by Design
(DSbD) Technology Platform Prototype, 105694.</p>
<p>This material is based upon work supported by the Defense Advanced
Research Projects Agency (DARPA) under Contract No. HR001122C0110 (&quot;ETC&quot;). Any
opinions, findings and conclusions or recommendations expressed in this
material are those of the author(s) and do not necessarily reflect the
views of the Defense Advanced Research Projects Agency (DARPA).</p>
<h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p><a href="https://www.cheribsd.org/">CheriBSD</a> is a version of the open-source
<a href="https://www.freebsd.org/">FreeBSD</a> operating system that has been extended to
use CHERI architectural protections.
CheriBSD is intended to:</p>
<ul>
<li>Provide a clean, in-depth illustration and template for how CHERI support
can be integrated with a general-purpose, MMU-enabled operating system;</li>
<li>Enable validation and evaluation of CHERI-extended processor architectures
and microarchitectures;</li>
<li>Act as an OS research platform for how operating systems can use CHERI;</li>
<li>Support the development and evaluation of CHERI-enabled applications; and</li>
<li>Provide a foundation for CHERI-enabled software demonstrations.</li>
</ul>
<p>This guide will support you in getting up and running with CheriBSD on the
CHERI-RISC-V and Arm Morello platforms.
As platforms vary substantially, from instruction-set emulators and executable
formal models through to FPGA- and ASIC-based hardware implementations, there
are several paths that can be taken to reach a shell prompt and start
productive work.
You might find that you want to build CheriBSD from scratch, or simply use one
of our downloadable pre-compiled images.
You may want to run directly from a live image in an emulator, or
alternatively want to use an installer image to install onto an internal disk
in an Arm Morello-based server or workstation.</p>
<h1><a class="header" href="#background" id="background">Background</a></h1>
<h2><a class="header" href="#cheri" id="cheri">CHERI</a></h2>
<p><strong>CHERI</strong> is an extension to processor Instruction-Set Architectures (ISAs) to
introduce support for fine-grained memory protection and software
compartmentalization.
This is done by introducing a new architectural data type, the <strong>CHERI
capability</strong>, which can be used to implement pointers with strong integrity,
provenance validity, spatial safety, and monotonity.
CHERI requires new microarchitectural support, including support for memory
tags that triack the provenance validity of capabilities in registers and
memory.
CHERI extensions have been specified for:</p>
<ul>
<li>Arm's 64-bit Armv8-a ISA, with the prototype architecture known as
<strong><a href="https://www.arm.com/architecture/cpu/morelloMorello">Morello</a></strong>.
The multi-GHz, multi-core, superscalar Morello design is a CHERI-extended
version of the Arm Neoverse N1, available on an evaluation board from Arm.</li>
<li>The open-source 32-bit and 64-bit RISC-V ISA, with the extended ISA known as
<strong><a href="https://www.cl.cam.ac.uk/techreports/UCAM-CL-TR-951.pdf">CHERI-RISC-V</a></strong>.
CHERI-RISC-V is available via multiple open-source soft processor cores for
use on FPGA.</li>
</ul>
<p>ISA-level emulation platforms exist for both architectures (QEMU for
CHERI-RISC-V and Morello, and Arm's Morello FVP for Morello).
Unless you have access to a Morello board or a high-end (and supported) FPGA
development platform, using
<a href="https://www.cl.cam.ac.uk/research/security/ctsrd/cheri/cheri-qemu.html">QEMU-CHERI</a>
will be the easiest way to get started using CHERI.
This guide covers all of these use cases.</p>
<p>You can learn more about CHERI by reading the technical report, <a href="https://www.cl.cam.ac.uk/techreports/UCAM-CL-TR-941.pdf">An
Introduction to
CHERI</a>.</p>
<h2><a class="header" href="#cheri-cc" id="cheri-cc">CHERI C/C++</a></h2>
<p><strong>CHERI C</strong> and <strong>CHERI C++</strong> are programming-language dialects closely tied
to CHERI-based code generation and Application Binary Interfaces (ABIs) that
directly support referential and spatial memory safety.
These language variants compile to <em>pure-capability code</em>, which implements
all language- and sub-language pointers using CHERI capabilities rather than
architectural integers.
With suitable OS support, they can also support temporal memory safety.</p>
<h2><a class="header" href="#cheribsd" id="cheribsd">CheriBSD</a></h2>
<p><strong>CheriBSD</strong> is an extended version of the open-source
<em><a href="https://www.freebsd.org/">FreeBSD</a></em> operating system.
FreeBSD is a mature UNIX-based operating system able to run on multiple
hardware architectures, and widely used in industry in service, appliance, and
embedded environments.
CheriBSD contains various CHERI-based extensions including support for kernel
and userspace memory safety, and supports multiple software
compartmentalization models.
CheriBSD runs on both CHERI-RISC-V and Morello with nearly identical feature
sets (Morello includes hardware virtualisation extensions not present in the
CHERI-RISC-V cores, and so CHERI-extended bhyve hypervisor support is not
available for CHERI-RISC-V).</p>
<h1><a class="header" href="#cheribsd-features" id="cheribsd-features">CheriBSD features</a></h1>
<p>CheriBSD extends FreeBSD with added CHERI-enabled features, such as kernel and
userspace memory safety.
Some of these features are in the main CheriBSD branch; other experimental
features  remain on development branches.</p>
<h2><a class="header" href="#kernel-compilation-modes" id="kernel-compilation-modes">Kernel compilation modes</a></h2>
<p>The CheriBSD kernel can be compiled either as hybrid or pure-capability code:</p>
<ul>
<li>The <strong>hybrid kernel</strong> enables capaility use in userspace while making
relatively little use of capabilities in the kernel's own implementation.</li>
<li>The <strong>pure-capability kernel</strong> implements strong referential and spatial
memory protection internally in the kernel, protecting against memory-safety
vulnerabilities in components such as the network stack and system-call
layer.</li>
</ul>
<h2><a class="header" href="#userspace-process-environments" id="userspace-process-environments">Userspace process environments</a></h2>
<p>The CheriBSD userspace likewise supports two different execution environments,
hybrid processes and CheriABI (pure-capability) processes:</p>
<ul>
<li><strong>Hybrid processes</strong> provide strong binary compatibility with the non-CHERI
version of the same architecture -- for example, aarch64 on Morello.</li>
<li><strong>CheriABI processes</strong> implement strong referential and spatial memory
protection through the system-call interface, dynamic linker, language
runtime including heap memory allocators, and compiler-generated code.
This protects against memory memory-safety vulnerabilities in both system
services and applications.
CheriABI is described in an <a href="https://www.cl.cam.ac.uk/research/security/ctsrd/pdfs/201904-asplos-cheriabi.pdf">ASPLOS 2019
paper</a>.</li>
</ul>
<p>Both environmnts can be used over either of the hybrid or pure-capability
kernels.</p>
<p>Pre-compiled third-party software applications (packages) are provided for
both ABIs, although CheriABI packages are currently considered experimental.
This is discussed further in the <a href="features/../packages/">chapter on packages</a>.</p>
<h2><a class="header" href="#userspace-heap-temporal-memory-safety-experimental" id="userspace-heap-temporal-memory-safety-experimental">Userspace heap temporal memory safety (experimental)</a></h2>
<p>CheriBSD implements, on an experimental development branch, support for the
Cornucopia heap temporal safety algorithm, as well as successor algorithms
based on load-side-barrier features present in the Morello prototype
architecture and processor design.
Cornucopia is described in an <a href="https://www.cl.cam.ac.uk/research/security/ctsrd/pdfs/2020oakland-cornucopia.pdf">IEEE SSP 2020
paper</a>.</p>
<h2><a class="header" href="#software-compartmentalization-experimental" id="software-compartmentalization-experimental">Software compartmentalization (experimental)</a></h2>
<p>CheriBSD implements, on experimental development branches, two different
CHERI-enabled software compartmentalization models:</p>
<ul>
<li><strong>Colocated processes (co-processes) compartmentalization</strong> accelerates
UNIX Inter-Process Communication (IPC) and context switching by colocating
multiple processes in the same address space, separating them using CHERI
capabilities.</li>
<li><strong>Dynamic-linker-based compartmentalization</strong> isolates shared libraries
within a process using CHERI capabilities limiting the access of attackers
who have achieved arbitrary code execution within a library.</li>
</ul>
<h2><a class="header" href="#virtualization-experimental" id="virtualization-experimental">Virtualization (experimental)</a></h2>
<p>CheriBSD implements, on an experimental development branch, CHERI extensions
to FreeBSD's bhyve Type 2 hypervisor on the Morello architecture.
This allows bhyve to host CHERI-enabled virtual machines, including those
running CheriBSD.</p>
<h1><a class="header" href="#unsupported-freebsd-features" id="unsupported-freebsd-features">Unsupported FreeBSD features</a></h1>
<p>Certain FreeBSD features are currently unavailable in CheriBSD, including:</p>
<ul>
<li>ZFS</li>
<li>DTrace</li>
</ul>
<p>Many other kernel features are not yet well validated, including:</p>
<ul>
<li>Non-UFS file systems</li>
<li>Most optional modules, such as various firewall systems</li>
</ul>
<p>Bug reports relating to these under-validated subsystems would be appreciated,
and may be submitted to the <a href="https://github.com/CTSRD-CHERI/cheribsd/issues">CheriBSD GitHub issue
tracker</a>.</p>
<h1><a class="header" href="#getting-cheribsd" id="getting-cheribsd">Getting CheriBSD</a></h1>
<p>CheriBSD can be installed by <a href="getting/downloading/README.html">downloading</a> or
<a href="getting/building/README.html">building</a> one of two types of disk images:</p>
<ul>
<li>
<p><strong>Memstick images</strong> that boot and automatically run <code>bsdinstall</code>, the FreeBSD
installer, which can be used to prepare a filesystem on a disk, and then
install CheriBSD onto it.
These will typically be used on Arm Morello boards.</p>
</li>
<li>
<p><strong>Live images</strong> that boot CheriBSD to a login prompt for interactive use.
These will typically be used on instruction-set emulators such as QEMU and
the Arm Morello FVP, as well as on FPGA.</p>
</li>
</ul>
<h1><a class="header" href="#downloading-image-files" id="downloading-image-files">Downloading image files</a></h1>
<p>Memstick and live images can both be downloaded from the <a href="https://www.cheribsd.org/">CheriBSD
website</a>.
Images are compressed using the UNIX <code>xz</code> command, and must be decompressed
before they can be used; for example by running:</p>
<pre><code>unxz cheribsd-memstick-dev-arm64-aarch64c-2022-04-05.img.xz
</code></pre>
<h1><a class="header" href="#building-image-files" id="building-image-files">Building image files</a></h1>
<p>CheriBSD can be built natively on an existing CheriBSD system (e.g., on an Arm
Morello box), and it can also be cross-built from FreeBSD, Linux, and macOS.
Building natively from an ISA-level emulator, such as QEMU, is not recommended
for performance reasons.</p>
<ul>
<li>
<p>Native builds follow the <a href="https://docs.freebsd.org/en/books/handbook/cutting-edge/#makeworld">same build
procedure</a>
as used for the baseline FreeBSD operating system.
Suitable git command-line substitions must be made to use CheriBSD rather
than FreeBSD source code.</p>
</li>
<li>
<p>CheriBSD cross-build orchestration is performed by the Python-based
<a href="https://github.com/CTSRD-CHERI/cheribuild">cheribuild</a> tool, which is
able to build CHERI-enabled toolchain, operating-system stack, and various
applications and other software used by the CHERI project.</p>
</li>
</ul>
<h2><a class="header" href="#key-source-repositories" id="key-source-repositories">Key source repositories</a></h2>
<p>CheriBSD repositories currently reside in the <a href="https://github.com/CTSRD-CHERI">CTSRD-CHERI GitHub
Organization</a>:</p>
<ul>
<li><a href="https://github.com/CTSRD-CHERI/cheribuild">cheribuild GitHub repository</a></li>
<li><a href="https://github.com/CTSRD-CHERI/cheribsd">CheriBSD GitHub repository</a></li>
<li><a href="https://github.com/CTSRD-CHERI/llvm-project">CHERI Clang/LLVM GitHub repository</a></li>
<li><a href="https://github.com/CTSRD-CHERI/gdb">CHERI GDB GitHub repository</a></li>
<li><a href="https://github.com/CTSRD-CHERI/qemu">QEMU-CHERI GitHub repository</a></li>
</ul>
<p>Unless you intend to modify CheriBSD, CHERI Clang/LLVM, CHERI GDB, or
QEMU-CHERI, you should not generally need to manually check out or compile
most of the above repositories.
Instead, existing prebuilt software images/packages should be used, or the
cheribuild command, which will orchestrate software cross-build for you.</p>
<h2><a class="header" href="#checking-out-cheribuild" id="checking-out-cheribuild">Checking out cheribuild</a></h2>
<p><code>[cheribuild](https://github.com/CTSRD-CHERI/cheribuild)</code> is a Python-based
build orchestration tool that is the preferred way to cross-build CheriBSD.
It can be checked out from GitHub:</p>
<pre><code>git clone git@github.com:CTSRD-CHERI/cheribuild.git
</code></pre>
<h2><a class="header" href="#building-and-running-cheribsdrisc-v-in-qemu" id="building-and-running-cheribsdrisc-v-in-qemu">Building and running CheriBSD/RISC-V in QEMU</a></h2>
<p>The following command builds a CheriBSD/RISC-V live image, and boots it in
QEMU-CHERI:</p>
<pre><code>% ./cheribuild -d build-and-run-cheribsd-riscv64-purecap
</code></pre>
<h2><a class="header" href="#building-and-running-cheribsdmorello-in-qemu" id="building-and-running-cheribsdmorello-in-qemu">Building and running CheriBSD/Morello in QEMU</a></h2>
<p>The following command builds a CheriBSD/Morello live image, and boots it in
QEMU-CHERI:</p>
<pre><code>% ./cheribuild -d build-and-run-cheribsd-morello-purecap
</code></pre>
<h2><a class="header" href="#building-cheribsdmorello-release-images" id="building-cheribsdmorello-release-images">Building CheriBSD/Morello release images</a></h2>
<p>The following command builds a CheriBSD/Morello installer (memstick) image
suitable to write to a USB stick:</p>
<pre><code>% ./cheribuild -d --clean cheribsd-release-morello-purecap
</code></pre>
<p>The resulting image file will be generated in a file with a name along the
lines of:
<code>output/cheribsd-release-morello-purecap/FreeBSD-14.0-CURRENT-arm64-aarch64c-memstick.img</code>.
This is relative to your <code>cheribuild</code> destination root, which is, by default,
<code>~/cheri</code>.</p>
<h2><a class="header" href="#obtaining-further-information" id="obtaining-further-information">Obtaining further information</a></h2>
<p>The <code>cheribuild</code> <a href="https://github.com/CTSRD-CHERI/cheribuild#readme">README.md</a>
provides detailed information on various parameters and targets its supports,
as well as its dependencies.</p>
<h1><a class="header" href="#installing-on-an-arm-morello-board" id="installing-on-an-arm-morello-board">Installing on an Arm Morello Board</a></h1>
<p>Once you have a disk image, you will either need to write it to a USB stick
to boot an Arm Morello system, or specify it as an argument to an emulator
such as QEMU-CHERI or the Arm Morello FVP.</p>
<h2><a class="header" href="#writing-an-installer-disk-image-to-a-usb-stick" id="writing-an-installer-disk-image-to-a-usb-stick">Writing an installer disk image to a USB stick</a></h2>
<p>With appropriate substitutions of image filename and target device, the
following command would write the image to a USB stick for use with a Morello
board:</p>
<pre><code>dd if=cheribsd-memstick-dev-arm64-aarch64c-2022-04-05.img of=/dev/DISK bs=1048576
</code></pre>
<p>It is also possible to write a live image to a USB stick, with appropriate
filename substitution.</p>
<h2><a class="header" href="#installing-an-arm-morello-system" id="installing-an-arm-morello-system">Installing an Arm Morello system</a></h2>
<p>It is possible to use Arm Morello systems both by booting the live image on a
USB stick, and also by installing to the internal hard disk.
In this section, we describe the how to perform an installation using the
memstick image.</p>
<h3><a class="header" href="#updating-and-configuring-the-morello-firmware" id="updating-and-configuring-the-morello-firmware">Updating and configuring the Morello firmware</a></h3>
<p><strong>It is important that the most recent Arm-provided firmware be installed on
your Morello board, as the board has most likely shipped with an older
firmware version.
If you are not running the latest version, you may experience hard-to-diagnose
behaviour or reliability problems.</strong></p>
<p>Newer versions contain important feature extensions (such as support for
network booting) and also bug fixes (such as persistent variable support for
UEFI, which is relied on for CheriBSD boot).
You should follow the directions provided in <a href="https://developer.arm.com/documentation/den0132/latest/">Arm's Morello installation
guide</a>, having
downloaded Arm's <a href="https://git.morello-project.org/morello/board-firmware">prebuilt Morello firmware
binaries</a>.
You can find detailed instructions for updating the firmware on the built-in
firmware SD card
<a href="https://developer.arm.com/documentation/den0132/0100/Flash-the-onboard-SD-card">here</a>.</p>
<p>We recommend that, rather than setting the firmware time to local time, as
recommended in the Arm guide, you instead set the firmware time to UTC; you
will then need to select UTC as the timezone in CheriBSD.</p>
<h3><a class="header" href="#connecting-to-the-serial-consoles" id="connecting-to-the-serial-consoles">Connecting to the serial consoles</a></h3>
<p>Multiple consolers are available via the USB debug port on an Arm Morello
board, including to the management microcontrollers, and also the console UART
for the application processor.
These typically attach as USB serial ports 0 (management console) and 2
(Morello console), and a serial connection program such as <code>cu</code> can be used to
connect to them.
For example, on a FreeBSD system, the following commands can be used to
connect:</p>
<ul>
<li>Management console: <code>cu -l /dev/cuaU0 -s 115200</code></li>
<li>Morello console: <code>cu -l /dev/cuaU2 -s 115200</code></li>
</ul>
<p>However, commands and device names will vary by operating system.</p>
<h3><a class="header" href="#starting-the-boot" id="starting-the-boot">Starting the boot</a></h3>
<p>Before powering on your Morello board, ensure that the installer USB stick is
inserted into one of the USB ports on the board.
Use the power switch to power the board on, which should lead to firmware
output on the management console during a multi-minute initialization and
boot cycle.
Once that has completed, you will see Morello firmware output on the Morello
console, followed by CheriBSD loader and kernel boot output.
You will eventually be prompted to select a terminal emulation type:</p>
<pre><code>Welcome to FreeBSD!

Please choose the appropriate terminal type for your system.
Common console types are:
   ansi     Standard ANSI terminal
   vt100    VT100 or compatible terminal
   xterm    xterm terminal emulator (or compatible)
   cons25w  cons25w terminal

Console type [xterm]:
</code></pre>
<p>In most cases, simply hitting Enter will be the right thing to do.
This will enter <code>bsdinstall</code>, the interactive FreeBSD installer.</p>
<h3><a class="header" href="#bsdinstall" id="bsdinstall">bsdinstall</a></h3>
<p><code>bsdinstall</code> uses the <code>libdialog</code> text interface library.
<strong>Be aware that you will sometimes need to use the space bar, and not enter
key, to select menu options, which many users find confusing.</strong></p>
<p>Select <strong>Install</strong> at the first menu by hitting Enter:</p>
<pre><code>                     ┌────────────Welcome──────────────┐
                     │ Welcome to FreeBSD! Would you   │
                     │ like to begin an installation   │
                     │ or use the live CD?             │
                     ├─────────────────────────────────┤
                     │ &lt;Install&gt; &lt; Shell &gt; &lt;Live CD&gt;   │
                     └─────────────────────────────────┘
</code></pre>
<h4><a class="header" href="#keymap-selection" id="keymap-selection">Keymap selection</a></h4>
<p>If you intend only to use the serial console, and not video console, select
the default keymap by hitting Enter at the next menu; otherwise, use the
cursor keys and space bar to select a country-specific keyboard layout:</p>
<pre><code>     ┌───────────────────────Keymap Selection──────────────────────────┐
     │ The system console driver for FreeBSD defaults to standard &quot;US&quot; │
     │ keyboard map. Other keymaps can be chosen below.                │
     │ ┌─────────────────────────────────────────────────────────────┐ │
     │ │&gt;&gt;&gt; Continue with default keymap                             │ │
     │ │-&gt;- Test default keymap                                      │ │
     │ │( ) Armenian phonetic layout                                 │ │
     │ │( ) Belarusian                                               │ │
     │ │( ) Belgian                                                  │ │
     │ │( ) Belgian (accent keys)                                    │ │
     │ │( ) Brazilian (accent keys)                                  │ │
     │ │( ) Brazilian (without accent keys)                          │ │
     │ │( ) Bulgarian (BDS)                                          │ │
     │ │( ) Bulgarian (Phonetic)                                     │ │
     │ │( ) Canadian Bilingual                                       │ │
     │ └────↓(+)─────────────────────────────────────────────12%─────┘ │
     ├─────────────────────────────────────────────────────────────────┤
     │                   &lt;Select&gt;          &lt;Cancel&gt;                    │
     └──────────────────[Press arrows, TAB or ENTER]───────────────────┘
</code></pre>
<h4><a class="header" href="#hostname" id="hostname">Hostname</a></h4>
<p>Press Enter to accept the default hostname, or replace it:</p>
<pre><code>           ┌───────────────────Set Hostname──────────────────────┐
           │ Please choose a hostname for this machine.          │
           │                                                     │
           │ If you are running on a managed network, please ask │
           │ your network administrator for an appropriate name. │
           │ ┌─────────────────────────────────────────────────┐ │
           │ │cheribsd                                         │ │
           │ └─────────────────────────────────────────────────┘ │
           ├─────────────────────────────────────────────────────┤
           │                     &lt;  OK  &gt;                        │
           └─────────────────────────────────────────────────────┘
</code></pre>
<h4><a class="header" href="#partitioning-automatic-or-manual" id="partitioning-automatic-or-manual">Partitioning (automatic or manual)</a></h4>
<p>Press Enter to select an automated UFS install:</p>
<pre><code>          ┌─────────────────────Partitioning───────────────────────┐
          │ How would you like to partition your disk?             │
          │ ┌────────────────────────────────────────────────────┐ │
          │ │   Auto (UFS)  Guided UFS Disk Setup                │ │
          │ │   Manual      Manual Disk Setup (experts)          │ │
          │ │   Shell       Open a shell and partition by hand   │ │
          │ │                                                    │ │
          │ │                                                    │ │
          │ └────────────────────────────────────────────────────┘ │
          ├────────────────────────────────────────────────────────┤
          │               &lt;  OK  &gt;        &lt;Cancel&gt;                 │
          └────────────────────────────────────────────────────────┘
</code></pre>
<h4><a class="header" href="#partitioning-disk-selection" id="partitioning-disk-selection">Partitioning (disk selection)</a></h4>
<p>Select the internal SATA hard disk, which will typically be ada0 on Morello
boards:</p>
<pre><code>       ┌───────────────────────Partitioning──────────────────────────┐
       │ Select the disk on which to install FreeBSD.                │
       │ ┌─────────────────────────────────────────────────────────┐ │
       │ │   ada0  224 GB ATA Hard Disk &lt;WDC WDS240G2G0A-00JH30&gt;   │ │
       │ │   da0   57 GB Disk &lt;SanDisk Ultra USB 3.0&gt;              │ │
       │ │                                                         │ │
       │ │                                                         │ │
       │ └─────────────────────────────────────────────────────────┘ │
       ├─────────────────────────────────────────────────────────────┤
       │                 &lt;  OK  &gt;         &lt;Cancel&gt;                   │
       └─────────────────────────────────────────────────────────────┘
</code></pre>
<h4><a class="header" href="#partition-entire-disk" id="partition-entire-disk">Partition (entire disk)</a></h4>
<p>Select Entire Disk and press Enter:</p>
<pre><code>                 ┌───────────────Partition──────────────────┐
                 │ Would you like to use this entire disk   │
                 │ (ada0) for FreeBSD or partition it to    │
                 │ share it with other operating systems?   │
                 │ Using the entire disk will erase any     │
                 │ data currently stored there.             │
                 ├──────────────────────────────────────────┤
                 │     &lt;Entire Disk&gt;   &lt; Partition &gt;        │
                 └──────────────────────────────────────────┘
</code></pre>
<h4><a class="header" href="#partition-entire-disk---confirmation" id="partition-entire-disk---confirmation">Partition (entire disk - confirmation)</a></h4>
<p>Press Enter to confirm:</p>
<pre><code>                 ┌───────────────Partition──────────────────┐
                 │ Would┌──────Confirmation─────────┐disk   │
                 │ (ada0│ This will erase the disk. │  o    │
                 │ share│ Are you sure you want to  │  s?   │
                 │ Using│ proceed?                  │       │
                 │ data ├───────────────────────────┤       │
                 ├──────│     &lt; Yes &gt;   &lt; No  &gt;     │  ─────┤
                 │     &lt;└───────────────────────────┘       │
                 └────────                             ─────┘
</code></pre>
<h4><a class="header" href="#partition-editor" id="partition-editor">Partition Editor</a></h4>
<p>Review the proposed partition scheme, select Finish, and then press Enter to
proceed:</p>
<pre><code>           ┌──────────────────Partition Editor────────────────────┐
           │ Please review the disk setup. When complete, press   │
           │ the Finish button.                                   │
           │┌────────────────────────────────────────────────────┐│
           ││ada0            224 GB  GPT                         ││
           ││  ada0p1        260 MB  efi            /boot/ef     ││
           ││  ada0p2        220 GB  freebsd-ufs    /            ││
           ││  ada0p3        3.6 GB  freebsd-swap   none         ││
           ││da0             57 GB   GPT                         ││
           ││  da0p1         33 MB   efi                         ││
           ││  da0p2         814 MB  freebsd-ufs                 ││
           ││                                                    ││
           │└────────────────────────────────────────────────────┘│
           ├──────────────────────────────────────────────────────┤
           │&lt;Create&gt; &lt;Delete&gt; &lt;Modify&gt; &lt;Revert&gt; &lt; Auto &gt; &lt;Finish&gt; │
           └──────────────────────────────────────────────────────┘
</code></pre>
<h4><a class="header" href="#partition-editor---confirmation" id="partition-editor---confirmation">Partition editor - confirmation</a></h4>
<p>Select Commit and press Enter to continue with writing out a new partition
table:</p>
<pre><code>           ┌──────────────────Partition Editor────────────────────┐
           │ Please review the disk setup. When complete, press   │
           │ the Finish button.                                   │
           │┌────────────────────────────────────────────────────┐│
           │┌──────────────────Confirmation─────────────────────┐││
           ││ Your changes will now be written to disk. If you  │
           ││ have chosen to overwrite existing data, it will   │
           ││ be PERMANENTLY ERASED. Are you sure you want to   │
           ││ commit your changes?                              │
           │├───────────────────────────────────────────────────┤
           ││ &lt;   Commit    &gt; &lt;Revert &amp; Exit&gt; &lt;    Back     &gt;   │
           │└───────────────────────────────────────────────────┘
           │└─
           ├──────────────────────────────────────────────────────┤
           │&lt;Create&gt; &lt;Delete&gt; &lt;Modify&gt; &lt;Revert&gt; &lt; Auto &gt; &lt;Finish&gt; │
           └──────────────────────────────────────────────────────┘
</code></pre>
<h4><a class="header" href="#setting-a-root-password" id="setting-a-root-password">Setting a root password</a></h4>
<p>Enter a new root password and press Enter.
Then confirm it by typing the same password again and pressing Enter.</p>
<pre><code>Please select a password for the system management account (root):
Typed characters will not be visible.
Changing local password for root
New Password:
</code></pre>
<h4><a class="header" href="#network-configuration" id="network-configuration">Network configuration</a></h4>
<p>If desired, configure Ethernet networking by pressing Enter.</p>
<pre><code>  ┌────────────────────────Network Configuration───────────────────────────┐
  │ Please select a network interface to configure:                        │
  │ ┌────────────────────────────────────────────────────────────────────┐ │
  │ │   re0  RealTek 8168/8111 B/C/CP/D/DP/E/F/G PCIe Gigabit Ethernet   │ │
  │ │                                                                    │ │
  │ │                                                                    │ │
  │ └────────────────────────────────────────────────────────────────────┘ │
  ├────────────────────────────────────────────────────────────────────────┤
  │                     &lt;  OK  &gt;           &lt;Cancel&gt;                        │
  └────────────────────────────────────────────────────────────────────────┘
</code></pre>
<h4><a class="header" href="#network-configuration---enabling-ipv4" id="network-configuration---enabling-ipv4">Network configuration - enabling IPv4</a></h4>
<p>If desired, enable IPv4 on the Ethernet interface by selecting Yes and
pressing Enter:</p>
<pre><code>                        ┌──Network Configuration────┐
                        │ Would you like to         │
                        │ configure IPv4 for this   │
                        │ interface?                │
                        ├───────────────────────────┤
                        │     &lt; Yes &gt;   &lt; No  &gt;     │
                        └───────────────────────────┘
</code></pre>
<h4><a class="header" href="#network-configuration---dhcp-for-ipv4" id="network-configuration---dhcp-for-ipv4">Network configuration - DHCP for IPv4</a></h4>
<p>If you will be using DHCP, select Yes and press Enter.
Otherwise select No and press Enter to perform a manual IPv4 configuration.</p>
<pre><code>                        ┌──Network Configuration────┐
                        │ Would you like to use     │
                        │ DHCP to configure this    │
                        │ interface?                │
                        ├───────────────────────────┤
                        │     &lt; Yes &gt;   &lt; No  &gt;     │
                        └───────────────────────────┘
</code></pre>
<h4><a class="header" href="#network-configuration---enabling-ipv6" id="network-configuration---enabling-ipv6">Network configuration - enabling IPv6</a></h4>
<p>If desired, enable IPv6 on the Ethernet interface by selecting Yes and
pressing Enter:</p>
<pre><code>                        ┌──Network Configuration────┐
                        │ Would you like to         │
                        │ configure IPv6 for this   │
                        │ interface?                │
                        ├───────────────────────────┤
                        │     &lt; Yes &gt;   &lt; No  &gt;     │
                        └───────────────────────────┘
</code></pre>
<h4><a class="header" href="#network-configuration---slaac-for-ipv6" id="network-configuration---slaac-for-ipv6">Network configuration - SLAAC for IPv6</a></h4>
<p>Press Enter to use stateless address autoconfiguration for IPv6:</p>
<pre><code>                        ┌──Network Configuration────┐
                        │ Would you like to try     │
                        │ stateless address         │
                        │ autoconfiguration         │
                        │ (SLAAC)?                  │
                        ├───────────────────────────┤
                        │     &lt; Yes &gt;   &lt; No  &gt;     │
                        └───────────────────────────┘
</code></pre>
<h4><a class="header" href="#network-configuration---resolver-configuration" id="network-configuration---resolver-configuration">Network configuration - resolver configuration</a></h4>
<p>Enter DNS resolution configuration information, or press Enter to confirm
autoconfigured DNS configuration:</p>
<pre><code>   ┌───────────────────────Network Configuration──────────────────────────┐
   │ Resolver Configuration                                               │
   │ ┌──────────────────────────────────────────────────────────────────┐ │
   │ │Search                                                            │ │
   │ │IPv6 DNS #1                                                       │ │
   │ │IPv6 DNS #2                                                       │ │
   │ │IPv4 DNS #1    192.168.4.1                                        │ │
   │ │IPv4 DNS #2                                                       │ │
   │ └──────────────────────────────────────────────────────────────────┘ │
   ├──────────────────────────────────────────────────────────────────────┤
   │                     &lt;  OK  &gt;           &lt;Cancel&gt;                      │
   └──────────────────────────────────────────────────────────────────────┘
</code></pre>
<h4><a class="header" href="#local-or-utc-clock" id="local-or-utc-clock">Local or UTC clock</a></h4>
<p>Press Enter to select a system clock on UTC</p>
<pre><code>   ┌───────────┤Select local or UTC (Greenwich Mean Time) clock├───────────┐
   │ Is this machine's CMOS clock set to UTC?  If it is set to local time, │
   │ or you don't know, please choose NO here!                             │
   │                                                                       │
   ├───────────────────────────────────────────────────────────────────────┤
   │                          [ Yes  ]   [  No  ]                          │
   └───────────────────────────────────────────────────────────────────────┘
</code></pre>
<h4><a class="header" href="#timezone-selection" id="timezone-selection">Timezone selection</a></h4>
<p>Select your continent and press Enter:</p>
<pre><code>                     ┌───────┤Time Zone Selector├───────┐
                     │ Select a region                  │
                     │ ┌──────────────────────────────┐ │
                     │ │ 1 Africa                     │ │
                     │ │ 2 America -- North and South │ │
                     │ │ 3 Antarctica                 │ │
                     │ │ 4 Asia                       │ │
                     │ │ 5 Atlantic Ocean             │ │
                     │ │ 6 Australia                  │ │
                     │ │ 7 Europe                     │ │
                     │ │ 8 Indian Ocean               │ │
                     │ │ 9 Pacific Ocean              │ │
                     │ │ 0 UTC                        │ │
                     │ └──────────────────────────────┘ │
                     ├──────────────────────────────────┤
                     │        [  OK  ]   [Cancel]       │
                     └──────────────────────────────────┘
</code></pre>
<p>Then select your country and press Enter:</p>
<pre><code>        ┌────────────────────┤Countries in Europe├────────────────────┐
        │ Select a country or region                                  │
        │ ┌─^^^─────────────────────────────────────────────────────┐ │
        │ │ 35 Poland                                               │ │
        │ │ 36 Portugal                                             │ │
        │ │ 37 Romania                                              │ │
        │ │ 38 Russian Federation                                   │ │
        │ │ 39 San Marino                                           │ │
        │ │ 40 Serbia                                               │ │
        │ │ 41 Slovakia                                             │ │
        │ │ 42 Slovenia                                             │ │
        │ │ 43 Spain                                                │ │
        │ │ 44 Svalbard and Jan Mayen                               │ │
        │ │ 45 Sweden                                               │ │
        │ │ 46 Switzerland                                          │ │
        │ │ 47 Turkey                                               │ │
        │ │ 48 Ukraine                                              │ │
        │ │ 49 United Kingdom of Great Britain and Northern Ireland │ │
        │ │ 50 Åland Islands                                        │ │
        │ └────────────────────────────────────────────────100%─────┘ │
        ├─────────────────────────────────────────────────────────────┤
        │                     [  OK  ]   [Cancel]                     │
        └─────────────────────────────────────────────────────────────┘
</code></pre>
<p>Confirm your choice by selecting Yes and pressing Enter:</p>
<pre><code>   ┌────────────────────────────┤Confirmation├────────────────────────────┐
   │ Does the abbreviation `BST' look reasonable?                         │
   ├──────────────────────────────────────────────────────────────────────┤
   │                          [ Yes  ]   [  No  ]                         │
   └──────────────────────────────────────────────────────────────────────┘
</code></pre>
<h4><a class="header" href="#setting-the-date-and-time" id="setting-the-date-and-time">Setting the date and time</a></h4>
<p>As desired, set the date, or select Skip and press Enter if you plan
to use network time synchronization:</p>
<pre><code>                   ┌────────────Time &amp; Date───────────────┐
                   │                                      │
                   │  Month            Year               │
                   │  ┌───────────────┐┌───────────────┐  │
                   │  │May            ││2022           │  │
                   │  └───────────────┘└───────────────┘  │
                   │  ┌─────↑(-)───────────────────────┐  │
                   │  │    Sun Mon Tue Wed Thu Fri Sat │  │
                   │  │ 18   1   2   3   4   5   6   7 │  │
                   │  │ 19   8   9  10  11  12  13  14 │  │
                   │  │ 20  15  16  17  18  19  20  21 │  │
                   │  │ 21  22  23  24  25  26  27  28 │  │
                   │  │ 22  29  30  31                 │  │
                   │  │                                │  │
                   │  └─────↓(+)───────────────────────┘  │
                   ├──────────────────────────────────────┤
                   │       &lt;Set Date&gt;    &lt;  Skip  &gt;       │
                   └──────────────────────────────────────┘
</code></pre>
<p>And, likewise, the time:</p>
<pre><code>                   ┌────────────Time &amp; Date───────────────┐
                   │                                      │
                   │           ┌──┐ ┌──┐ ┌──┐             │
                   │           │00│:│34│:│36│             │
                   │           └──┘ └──┘ └──┘             │
                   │                                      │
                   ├──────────────────────────────────────┤
                   │       &lt;Set Time&gt;    &lt;  Skip  &gt;       │
                   └──────────────────────────────────────┘
</code></pre>
<h4><a class="header" href="#system-configuration" id="system-configuration">System configuration</a></h4>
<p>As desired, enable any further services (e.g., <code>ntpd</code> and <code>ntpdate</code>) by
selecting them and hitting Space:</p>
<pre><code>  ┌────────────────────────System Configuration───────────────────────────┐
  │ Choose the services you would like to be started at boot:             │
  │ ┌───────────────────────────────────────────────────────────────────┐ │
  │ │ [ ] local_unbound  Local caching validating resolver              │ │
  │ │ [*] sshd           Secure shell daemon                            │ │
  │ │ [ ] moused         PS/2 mouse pointer on console                  │ │
  │ │ [ ] ntpdate        Synchronize system and network time at bootime │ │
  │ │ [ ] ntpd           Synchronize system and network time            │ │
  │ │ [ ] powerd         Adjust CPU frequency dynamically if supported  │ │
  │ │ [*] dumpdev        Enable kernel crash dumps to /var/crash        │ │
  │ │                                                                   │ │
  │ │                                                                   │ │
  │ └───────────────────────────────────────────────────────────────────┘ │
  ├───────────────────────────────────────────────────────────────────────┤
  │                               &lt;  OK  &gt;                                │
  └───────────────────────────────────────────────────────────────────────┘
</code></pre>
<p>Then press Enter to continue.</p>
<h4><a class="header" href="#add-user-accounts" id="add-user-accounts">Add user accounts</a></h4>
<p>If desired, select Yes and press Enter to add non-root accounts.
Otherwise, select No and press Enter</p>
<h4><a class="header" href="#final-configuration" id="final-configuration">Final configuration</a></h4>
<p>If there are further configuration settings to change, select an appropriate
option from the menu and press Space.
Otherwise, press Enter to complete the installation:</p>
<pre><code> ─┌─────────────────────────Final Configuration───────────────────────────┐────
  │ Setup of your FreeBSD system is nearly complete. You can now modify   │
  │ your configuration choices. After this screen, you will have an       │
  │ opportunity to make more complex changes using a shell.               │
  │ ┌───────────────────────────────────────────────────────────────────┐ │
  │ │   Exit              Apply configuration and exit installer        │ │
  │ │   Add User          Add a user to the system                      │ │
  │ │   Root Password     Change root password                          │ │
  │ │   Hostname          Set system hostname                           │ │
  │ │   Network           Networking configuration                      │ │
  │ │   Services          Set daemons to run on startup                 │ │
  │ │   System Hardening  Set security options                          │ │
  │ │   Time Zone         Set system timezone                           │ │
  │ │   Handbook          Install FreeBSD Handbook (requires network)   │ │
  │ │                                                                   │ │
  │ │                                                                   │ │
  │ └───────────────────────────────────────────────────────────────────┘ │
  ├───────────────────────────────────────────────────────────────────────┤
  │                               &lt;  OK  &gt;                                │
  └───────────────────────────────────────────────────────────────────────┘
</code></pre>
<h4><a class="header" href="#manual-configuration" id="manual-configuration">Manual configuration</a></h4>
<p>If desired, select Yes and press Enter to drop to a shell before reboot.
Otherwise, select No and press Enter.</p>
<pre><code>                   ┌───────Manual Configuration──────────┐
                   │ The installation is now finished.   │
                   │ Before exiting the installer, would │
                   │ you like to open a shell in the new │
                   │ system to make any final manual     │
                   │ modifications?                      │
                   ├─────────────────────────────────────┤
                   │         &lt; Yes &gt;     &lt; No  &gt;         │
                   └─────────────────────────────────────┘
</code></pre>
<h3><a class="header" href="#complete" id="complete">Complete</a></h3>
<p>Select Reboot and press Enter:</p>
<pre><code>                        ┌─────────Complete───────────┐
                        │ Installation of FreeBSD    │
                        │ complete! Would you like   │
                        │ to reboot into the         │
                        │ installed system now?      │
                        ├────────────────────────────┤
                        │   &lt;Reboot &gt;  &lt;Live CD&gt;     │
                        └────────────────────────────┘
</code></pre>
<h3><a class="header" href="#rebooting-after-installation" id="rebooting-after-installation">Rebooting after installation</a></h3>
<p>Remove the USB stick to prevent the installer from running after a system
reboot.
This is due to a <a href="installing/../issues/">Morello firmware bug</a> tht prevents proper
restoring system boot-disk state after a reboot.</p>
<p>Due to a <a href="installing/../issues/">Morello firmware bug</a>, OS-triggered reboot is not
reliable.
Until a firmware revision correcting this bug is released, you will need to
type <code>reboot</code> on the management console to reboot after installation.</p>
<h3><a class="header" href="#logging-in" id="logging-in">Logging in</a></h3>
<p>Log in using the username <code>root</code> and the password you entered during the
installation process:</p>
<pre><code>...
Mounting late filesystems:.
Security policy loaded: MAC/ntpd (mac_ntpd)
Starting ntpd.
Starting cron.
Starting sendmail_submit.
Starting sendmail_msp_queue.
Performing sanity check on sshd configuration.
Starting sshd.
Starting background file system checks in 60 seconds.

Sun May  8 00:13:04 BST 
CheriBSD/arm64 (cheribsd) (ttyu0)

login: root
Password:
May  8 00:13:25 cheribsd login[772]: ROOT LOGIN (root) ON ttyu0
Last login: Sat May  7 23:41:04 on ttyu0
FreeBSD 14.0-CURRENT #0 dev-d4897febcde: Tue May  3 13:34:49 BST 2022     rnw24@zeno.sec.cl.cam.ac.uk:/home/rnw24/cheri/build/cheribsd-morello-purecap-build/home/rnw24/cheri/cheribsd/arm64.aarch64c/sys/GENERIC-MORELLO

Welcome to CheriBSD!

CheriBSD extends FreeBSD to implement memory protection and software
compartmentalization features available in CHERI-extended CPUs.

We provide support via a mailing list:
  https://www.cl.cam.ac.uk/research/security/ctsrd/cheri/cheri-lists.html

And also via the CHERI-CPU Slack:
  https://www.cl.cam.ac.uk/research/security/ctsrd/cheri/cheri-slack.html

CheriBSD source may be found at:
  https://github.com/CTSRD-CHERI/cheribsd/

Find out more about about CHERI at https://cheri-cpu.org/
You have new mail.
root@cheribsd:~ # 
</code></pre>
<p>You can now add further users, install SSH keys for remote access, install
packages, and so on.</p>
<h1><a class="header" href="#third-party-packages" id="third-party-packages">Third-party packages</a></h1>
<p>CheriBSD on Morello ships with both hybrid and CheriABI packages
(compilations) of the FreeBSD ports collection, each targeting a different
form of code generation and Application Binary Interface (ABI).
They have different levels of completeness, maturity, security, and support.</p>
<p><strong>This document describes CheriBSD support for packages as of the 22.05
release, which differs substantially from prior releases and software
snapshots due to the introduction of a <code>pkg64c</code> package set.</strong></p>
<h2><a class="header" href="#hybrid-abi-packages" id="hybrid-abi-packages">Hybrid ABI packages</a></h2>
<p><strong>Hybrid ABI packages</strong> are compiled almost identically to packages in the
baseline non-CHERI architecture (e.g., Armv8-a for Morello, and 64-bit
RISC-V for RISC-V), and do not have improvements in memory protection or
software compartmentalization.
There are over 20,000 packages available.
These are considered <em>appropriate for day-to-day use</em>.</p>
<p>These packages are installed in the <code>/usr/local64</code> hierarchy. By default
<code>/usr/local64/bin</code> and <code>/usr/local64/sbin</code> should be in your path.</p>
<p><em>Note:</em> Because these packages are installed in a non-standard location,
there may be bugs related to them looking in <code>/usr/local</code> instead of
<code>/usr/local64</code> for dependencies. Please report bugs of this sort in
the <a href="https://github.com/CTSRD-CHERI/cheribsd-ports/issues">CheriBSD ports issue tracker</a>.</p>
<h2><a class="header" href="#cheriabi-packages" id="cheriabi-packages">CheriABI packages</a></h2>
<p><strong>CheriABI packages</strong> are compiled using pure-capability CHERI C/C++, and
employ fine-grained C/C++ memory protection.
There are currently over 8,000 CheriABI packages available.
These packages are considered <em>experimental</em>.</p>
<p>These packages are installed in the standard <code>/usr/local</code> hierarchy.</p>
<p><em>Note:</em> These packages compile, but many have CHERI-related warnings that
have not been audited and only a limited set have been tested.  Bugs
related to CHERI support can be reported in the
<a href="https://github.com/CTSRD-CHERI/cheribsd-ports/issues">CheriBSD ports issue tracker</a>.</p>
<h2><a class="header" href="#managing-packages-in-cheribsd" id="managing-packages-in-cheribsd">Managing packages in CheriBSD</a></h2>
<p><em>Note:</em> As of this writing we only provide packages for Morello systems.
We aim to add RISC-V package sets in the near future.</p>
<p>Hybrid and CheriABI packages can be installed via two independent instances of
the package system in CheriBSD, one for each ABI.
The intention is that, over time, the CheriABI packages will become more
mature, and hence the preferred collection for day-to-day use.</p>
<p>The default <code>pkg</code> command will print a note describing this arrangement, but
cannot be used for package management as described in FreeBSD documentation.
To manage and install hybrid packages, use the <code>pkg64</code> command.
To manage and install CheriABI packages, use the <code>pkg64c</code> command.
We expect that <code>pkg64c</code> will be renamed to <code>pkg</code> in a future CheriBSD release.</p>
<p>You can learn more about FreeBSD's package manager by reading the <a href="https://www.freebsd.org/cgi/man.cgi?pkg(7)">pkg(8)
manual page</a>
and the <a href="https://docs.freebsd.org/en/books/handbook/ports/">FreeBSD Handbook chapter on packages and
ports</a>.</p>
<h1><a class="header" href="#cheriabi-hello-world" id="cheriabi-hello-world">CheriABI &quot;Hello World&quot;</a></h1>
<p>These instructions are intended for use on an Arm Morello board, and install
hybrid ABI versions of key toolchain and utilities using <code>pkg64</code>.
The commands will (eventually) work the same on CHERI-RISC-V, but output
details and registers in GDB will differ.</p>
<h2><a class="header" href="#toolchain-installation" id="toolchain-installation">Toolchain installation</a></h2>
<p>You will need the Morello LLVM toolchain and Morello GDB for this
exercise. To install LLVM, use the command:</p>
<p><code>pkg64 install llvm-base</code></p>
<p>If this is the first time you are using <code>pkg64</code> on this system, you will
be prompted to bootstrap the <code>pkg</code> package before the package database
is downloaded and you are prompted to confirm before installing <code>llvm</code>
and its dependencies:</p>
<pre><code>root@cheribsd:~ # pkg64 install llvm-base
The package management tool is not yet installed on your system.
Do you want to fetch and install it now? [y/N]: y
Bootstrapping pkg from pkg+http://pkg.CheriBSD.org/CheriBSD:20220314:aarch64, please wait...
Verifying signature with trusted certificate pkg.cheribsd.org.2022032901... done
Installing pkg-1.17.5_1...
Extracting pkg-1.17.5_1: 100%
Updating CheriBSD repository catalogue...
Fetching meta.conf: 100%    163 B   0.2kB/s    00:01
Fetching packagesite.pkg: 100%    4 MiB   1.4MB/s    00:03
Processing entries: 100%
CheriBSD repository update completed. 20954 packages processed.
All repositories are up to date.
Updating database digests format: 100%
The following 12 package(s) will be affected (of 0 checked):

New packages to be INSTALLED:
        gettext-runtime: 0.21
        indexinfo: 0.3.1
        libedit: 3.1.20210910,1
        libffi: 3.3_1
        libxml2: 2.9.13_2
        llvm: 13,1
        llvm-base: 1
        llvm-morello: 13.0.d20220502_1
        mpdecimal: 2.5.1
        perl5: 5.32.1_1
        python38: 3.8.13
        readline: 8.1.2

Number of packages to be installed: 12

The process will require 902 MiB more space.
190 MiB to be downloaded.

Proceed with this action? [y/N]: y
[1/12] Fetching llvm-base-1.pkg: 100%    3 KiB   2.8kB/s    00:01
[2/12] Fetching llvm-13,1.pkg: 100%   11 KiB  11.2kB/s    00:01
...
[12/12] Fetching libedit-3.1.20210910,1.pkg: 100%  119 KiB 121.8kB/s    00:01
Checking integrity... done (0 conflicting)
[1/12] Installing indexinfo-0.3.1...
[1/12] Extracting indexinfo-0.3.1: 100%
...
[12/12] Installing llvm-base-1...
[12/12] Extracting llvm-base-1: 100%
=====
...

</code></pre>
<p><em>Note:</em> By default FreeBSD ships with the <code>vi</code> and <code>ee</code> editors. You may
wish to install the <code>nano</code> or <code>vim</code> package to access a
more familiar editor. Currently only hybrid packages installable with
<code>pkg64</code> are available.</p>
<h2><a class="header" href="#source-code" id="source-code">Source code</a></h2>
<pre><code class="language-C">#include &lt;stdio.h&gt;

int
main(void)
{
	printf(&quot;Hello world\n&quot;);
}
</code></pre>
<h2><a class="header" href="#building" id="building">Building</a></h2>
<p>To build a CheriABI Hello World program use:</p>
<p><code>cc -g -O2 -Wall -o helloworld helloworld.c</code></p>
<p>You can verify this is a CheriABI binary with the <code>file</code> command:</p>
<pre><code>root@cheribsd:~ # file helloworld
helloworld: ELF 64-bit LSB pie executable, ARM aarch64, C64, CheriABI, version 1 (SYSV), dynamically linked, interpreter /libexec/ld-elf.so.1, for FreeBSD 14.0 (1400053), FreeBSD-style, with debug_info, not stripped
</code></pre>
<h2><a class="header" href="#running" id="running">Running</a></h2>
<p>Run the program:</p>
<pre><code>root@cheribsd:~ # ./helloworld
Hello world
</code></pre>
<h2><a class="header" href="#debugging" id="debugging">Debugging</a></h2>
<p>First, if it is not already installed, install the CHERI GDB debugger:</p>
<p><code>pkg64 install gdb-cheri</code></p>
<p>You can then debug <code>helloworld</code> by running GDB and setting a breakpoint
on <code>main</code>:</p>
<pre><code>root@cheribsd:~ # gdb ./helloworld
GNU gdb (GDB) 8.3
...
Reading symbols from ./helloworld...
...
(gdb) b main
Breakpoint 1 at 0x10a14: file helloworld.c, line 6.
(gdb) r
Starting program: /root/helloworld

Breakpoint 1, main () at helloworld.c:6
6           printf(&quot;Hello world\n&quot;);
(gdb) 
</code></pre>
<p>If you then step into the <code>printf</code> call you will see that GDB prints
the capability argument with expanded information including bounds and
permissions:</p>
<pre><code>(gdb) s
printf (fmt=0x1006e0 [rR,0x1006e0-0x1006ed] &quot;Hello world\n&quot;)
    at /home/bed22/cheri/cheribsd/lib/libc/stdio/printf.c:57
57      /home/bed22/cheri/cheribsd/lib/libc/stdio/printf.c: No such file or directory.
</code></pre>
<p>The argument can also be examined directly as either an integer or capability register:</p>
<pre><code>(gdb) info reg x0
x0             0x1006e0            1050336
(gdb) info reg c0
c0             0x905f400046ed06e000000000001006e0 0x1006e0 [rR,0x1006e0-0x1006ed]
(gdb)
</code></pre>
<p><em>Note:</em> as of this writing, GDB emits a large number of complaints like
those below when loading files. They are mostly harmless and will be
addressed in a future release:</p>
<pre><code>BFD: /lib/libc.so.7: unsupported relocation type 0xe802
</code></pre>
<h1><a class="header" href="#morello-known-issues" id="morello-known-issues">Morello known issues</a></h1>
<p>The following known issues may affect the reliability and usability of
CheriBSD on Morello:</p>
<ul>
<li>Due to a firmware bug, OS-triggered reboot may lead the system to hang.
Use the &quot;reboot&quot; command on the management console to reboot the system.</li>
<li>Due to a firmware bug, some earlier firmware versions are not able to
persist UEFI configuration variables.
This affects, for example, the installation environment as the OS installer
cannot instruct the firmware to boot only from the installed target, and not
further USB sticks.</li>
</ul>
<p><strong>It is extremely important that you use the most recent firwmare with your
Morello board, to avoid these and other issues present in earlier firmware
releases.</strong></p>
<h1><a class="header" href="#getting-help" id="getting-help">Getting help</a></h1>
<p>CheriBSD is a community-supported open-source research operating system.
While every effort has been made to engineer to a high quality, many aspects
of OS design for CHERI processors remain active research, and there are
constrained engineering resources available to build, maintain, and support
the system.
As you gain experience with CheriBSD, your help in supporting newcomers in the
community will be greatly appreciated.</p>
<h2><a class="header" href="#github-issue-tracker-and-pull-requests" id="github-issue-tracker-and-pull-requests">GitHub issue tracker and pull requests</a></h2>
<p>CheriBSD is developed and maintained in the <a href="https://github.com/CTSRD-CHERI/cheribsd">CheriBSD GitHub
repository</a>, which includes an issue
tracker in which bugs can be reported, as well as permitting pull requests to
be submitted.</p>
<p>This document is also mained in a <a href="https://github.com/CTSRD-CHERI/cheribsd-getting-started">GitHub
Repository</a>, and your
feedback and improvements would be very much appreciated.</p>
<h2><a class="header" href="#cheribsd-slack-on-cheri-cpuslackcom" id="cheribsd-slack-on-cheri-cpuslackcom">CheriBSD Slack on cheri-cpu.slack.com</a></h2>
<p>Support for CheriBSD is provided via the <a href="https://www.cl.cam.ac.uk/research/security/ctsrd/cheri/cheri-slack.html">CHERI CPU
Slack</a>,
where there is a <code>#cheribsd</code> channel where many of CheriBSD developers and
users can be found.</p>
<h2><a class="header" href="#cheribsd-mailing-lists" id="cheribsd-mailing-lists">CheriBSD mailing lists</a></h2>
<p>There are also several CheriBSD email lists available:</p>
<ul>
<li><a href="https://lists.cam.ac.uk/sympa/info/cl-cheribsd-announce">CheriBSD announcement mailing list (low volume)</a></li>
<li><a href="https://lists.cam.ac.uk/sympa/info/cl-cheribsd-discuss">CheriBSD general discussion</a></li>
<li>CheriBSD security vulnerabilities contact address <a href="mailto:cl-cheribsd-security@lists.cam.ac.uk">cl-cheribsd-security@lists.cam.ac.uk</a> </li>
</ul>
<h2><a class="header" href="#in-person-events-and-meetings" id="in-person-events-and-meetings">In-person events and meetings</a></h2>
<p>You can meet with the CheriBSD developers at a number of conferences and other
events, including:</p>
<ul>
<li>
<p>UKRI Digital Security by Design (DSbD) All Hands meetings that take place in
the UK twice annually to discuss the Morello architecture, board, and its
use.</p>
</li>
<li>
<p>FreeBSD developer summits and conferences around the world, including (when
it takes place) the BSDCan conference in Canada, and the EuroBSDCon
conference in Europe.</p>
</li>
</ul>
<p>There is discussion around creating further, more frequent CHERI workshops in
the UK in the future.</p>
<p>Most CheriBSD developers are based at the University of Cambridge (UK) and SRI
International (USA), and it is possible to set up meetings with them directly.
Get in touch if this would be useful to you.</p>
<h1><a class="header" href="#resources" id="resources">Resources</a></h1>
<p>In addition to the <a href="resources/support/README.html">CheriBSD support channels</a>, the
following resources may also be useful.</p>
<h2><a class="header" href="#cheribsd-1" id="cheribsd-1">CheriBSD</a></h2>
<ul>
<li><a href="https://www.cheribsd.org/">CheriBSD website</a></li>
</ul>
<h2><a class="header" href="#cheri-1" id="cheri-1">CHERI</a></h2>
<ul>
<li><a href="https://www.cl.cam.ac.uk/research/security/ctsrd/cheri/">CHERI project
website</a></li>
<li><a href="https://www.cl.cam.ac.uk/techreports/UCAM-CL-TR-941.pdf">An Introduction to
CHERI</a></li>
<li><a href="https://www.cl.cam.ac.uk/techreports/UCAM-CL-TR-947.pdf">The CHERI C/C++ Programming
Guide</a></li>
</ul>
<h2><a class="header" href="#freebsd" id="freebsd">FreeBSD</a></h2>
<ul>
<li><a href="https://docs.freebsd.org/en/books/handbook/">The FreeBSD Handbook</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
